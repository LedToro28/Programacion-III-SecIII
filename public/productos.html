<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Productos - E-commerce</title>
    <link rel="stylesheet" href="style/style.css">
</head>
<body>
    <div class="form-container">
        <h2>Panel de Productos</h2>
        
        <form id="productForm">
            <input type="text" id="nombre" placeholder="Nombre del producto" required>
            <input type="text" id="codigo" placeholder="Código único (ej: ABC-123)" required>
            <input type="number" id="precio" placeholder="Precio ($)" step="0.01" required>
            <textarea id="descripcion" placeholder="Descripción breve" required></textarea>
            <button type="submit">Guardar Producto</button>
        </form>

        <hr>
        <h3>Lista de Inventario</h3>
        <div id="listaProductos">
            </div>
        
        <p><a href="index.html">Cerrar Sesión</a></p>
    </div>

    <script>
        // Obtener datos del usuario desde localStorage (guardados al hacer login)
        const userLevel = localStorage.getItem('nivelUsuario') || 'usuario';

        // 1. Lógica para GUARDAR productos
        document.getElementById('productForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const data = {
                nombre: document.getElementById('nombre').value,
                codigo: document.getElementById('codigo').value,
                precio: parseFloat(document.getElementById('precio').value),
                descripcion: document.getElementById('descripcion').value,
                nivelUsuario: userLevel // Enviamos el nivel para la validación de la Fase 3
            };

            const res = await fetch('/api/productos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await res.json();
            alert(result.message || result.error);
            
            if(res.ok) {
                document.getElementById('productForm').reset();
                cargarProductos(); // Refrescar la lista
            }
        };

        // 2. Lógica para CARGAR y mostrar productos
        async function cargarProductos() {
            const res = await fetch('/api/productos');
            const productos = await res.json();
            const contenedor = document.getElementById('listaProductos');
            
            contenedor.innerHTML = productos.map(p => `
                <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 5px; border-radius: 5px;">
                    <strong>${p.nombre}</strong> (${p.codigo})<br>
                    Precio: $${p.precio} | ${p.descripcion}
                </div>
            `).join('');
        }

        // Cargar al iniciar
        cargarProductos();
    </script>
</body>
</html>